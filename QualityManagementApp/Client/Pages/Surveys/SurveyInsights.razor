@page "/survey_insights/{surveyId}"
@inject ISurveyInsightsService InsightsService
@using static QualityManagementApp.Shared.SurveyInsightModel

<PageTitle>Estadisticas</PageTitle>
<BusyOverlay @bind-visible="@InsightsService.IsBusy" />

<MudStack Spacing="9" Class="my-9">
    <MudText Align="Align.Center" Color="Color.Secondary" Typo="Typo.h4">Estadisticas de la encuesta</MudText>

    @foreach (var item in InsightsService.Questions)
    {
        <MudText Typo="Typo.h6" Align="Align.Center" Class="mt-3">@item.Title</MudText>
        <MudStack Row="true" Spacing="9" Justify="Justify.Center">
            @*@(List<SurveyInsightModel.Chart>? Data = )*@
            <MudList Clickable="false" Dense="true">
                @foreach (var item in InsightsService.ReturnInsight(SurveyId??"", item.PkQuestion))
                {
                    <MudListItem>
                        <MudText Typo="Typo.caption" Class="mr-9">@item.Answer </MudText>
                        <MudText Typo="Typo.caption" Color="Color.Secondary" Style="float: right">@item.Total</MudText>
                    </MudListItem>
                }
            </MudList>
            @*<MudChart ChartType="ChartType.Pie" InputData="@(InsightsService.ReturnInsight(SurveyId, item.PkQuestion).Select(i => (double)i.Total).ToArray())" InputLabels="@(InsightsService.ReturnInsight(SurveyId, item.PkQuestion).Select(n => n.Answer).ToArray())" Width="150px" Height="150px" />*@
        </MudStack>
    }
</MudStack>


@code {
    [Parameter]
    public string? SurveyId { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        InsightsService.IsBusy = true;
        await InsightsService.GetQuestions(SurveyId);
        InsightsService.IsBusy = false;
    }

    public List<model> data { get; set; } = new();

    public SurveyInsights()
    {
        data = new()
        {
            new model { id = 77, name = "Uranium" },
            new model { id = 5, name = "Caesium" },
            new model { id = 25, name = "Plutonium" },
            new model { id = 20, name = "Thorium" },
            new model { id = 33, name = "bbye gy ued" }
        };
    }


    public class model
    {
        public double id { get; set; }
        public string name { get; set; } = null!;
    }

}
